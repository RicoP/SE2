<html>
	<head>
		<script src="/socket.io/socket.io.js"></script>
		<script>
			//Das Objekt, das gerade bewegt wird.
			var dragobjekt = null;

			// Position, an der das Objekt angeklickt wurde.
			var dragx = 0;
			var dragy = 0;

			// Mausposition
			var posx = 0;
			var posy = 0;

			function dragstart(element) {
				//Wird aufgerufen, wenn ein Objekt bewegt werden soll.

				dragobjekt = element;
				dragx = posx - dragobjekt.offsetLeft;
				dragy = posy - dragobjekt.offsetTop;
			}

			function dragstop() {
				//Wird aufgerufen, wenn ein Objekt nicht mehr bewegt werden soll.

				dragobjekt = null;
			}

			function drag(ereignis) {
				//Wird aufgerufen, wenn die Maus bewegt wird und bewegt bei Bedarf das Objekt.

				posx = document.all ? window.event.clientX : ereignis.pageX;
				posy = document.all ? window.event.clientY : ereignis.pageY;
				if(dragobjekt != null) {
					dragobjekt.style.left = (posx - dragx) + "px";
					dragobjekt.style.top = (posy - dragy) + "px";
				}
			}


			window.onload = init;

			function init() {
				var url, socket;
				url = window.location.protocol + "//" + window.location.hostname;
				socket = io.connect(url);

				document.onmousemove = drag;
				document.onmouseup = dragstop;

				setup();

				socket.on('news', function(data) {
					console.log(data);
					socket.emit('my other event', {
						my : 'data'
					});
				});
			}

			function setup() {
				var button;
				button = document.createElement("button");
				button.textContent = "Neu";
				button.onclick = createNewBlock;

				document.body.appendChild(button);
				document.body.style.backgroundColor = 'rgb(200,255,200)';
			}

			function newBlock() {
				var token, r, g, b, x, y, w, h;
				token = "_" + (~~(Math.random() * 9999999) );
				r = ~~(255 * Math.random()) % 255;
				g = ~~(255 * Math.random()) % 255;
				b = ~~(255 * Math.random()) % 255;
				h = 50 + ~~(50 * Math.random());
				w = 200 + ~~(100 * Math.random());
				x = 30 + ~~(255 * Math.random());
				y = 30 + ~~(255 * Math.random());

				return {
					"n" : token, // Eindeutiger Name
					"r" : r, // Rotanteil 0..255
					"g" : g, // Grünanteil 0..255
					"b" : b, // Blauanteil 0..255
					"h" : h, // Höhe
					"w" : w, // Breite
					"x" : x, // X-Position
					"y" : y // Y-Position
				};
			}

			function createNewBlock() {
				var data, block, r, g, b, x, y, w, h, closeButton, textBox, mouseIsDown, mousePos;
				data = newBlock();
				block = document.createElement("span");

				block.id = data.n;
				mouseIsDown = false;

				block.style.position = "absolute";
				block.style.height = data.h;
				block.style.width = data.w;
				block.style.left = data.x;
				block.style.top = data.y;
				block.style.backgroundColor = 'rgb(' + data.r + ',' + data.g + ',' + data.b + ')';
				closeButton = document.createElement("button");
				closeButton.textContent = "X";
				closeButton.onclick = function() {
					document.body.removeChild(block);
				};

				block.appendChild(closeButton);
				textBox = document.createElement("input");
				textBox.type = "text";

				block.appendChild(textBox);

				block.onmousedown = function() {
					dragstart(block)
				};

				document.body.appendChild(block);
			}
		</script>
		<title>Node.js Demo</title>
	</head>
	<body></body>
</html>